package com.example.android.effectivenavigation;

import java.io.BufferedReader;
import java.io.DataOutputStream;
import java.io.InputStreamReader;
import java.io.UnsupportedEncodingException;
import java.net.Socket;

import com.example.android.effectivenavigation.MessageConsumer.OnReceiveMessageHandler;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

import android.app.Activity;
import android.content.SharedPreferences;
import android.os.AsyncTask;
import android.preference.PreferenceManager;
import android.widget.TextView;
import android.widget.Toast;

public class RabbitConsumerHelper extends AsyncTask<Object, Object, String> {
	
	private MessageConsumer mConsumer;
    private TextView mOutput;
	public Activity Context;
	protected Channel mModel = null;
    protected Connection  mConnection;
	private void runCommand(Object... commands) {
		

		try {

			mOutput = (TextView) Context.findViewById(R.id.output);
			 
	        //Create the consumer
	        mConsumer = new MessageConsumer("192.168.1.67");
	 
	        //Connect to broker
	        mConsumer.connectToRabbitMQ();
	 
	        //register for messages
	        mConsumer.setOnReceiveMessageHandler(new OnReceiveMessageHandler(){
	 
	            public void onReceiveMessage(byte[] message) {
	                String text = "";
	                try {
	                    text = new String(message, "UTF8");
	                } catch (UnsupportedEncodingException e) {
	                    e.printStackTrace();
	                }
	 
	                mOutput.append("\n"+text);
	            }
	        });
              
              
              

		} catch (Exception ex) {

		}
		

	}
	
	

	public void Run(String command, Activity context) {
		execute(command, context);
	}
	

	@Override
	protected String doInBackground(Object... params) {
		Context = (Activity) params[1];
		runCommand(params);

		
		return "";
	}

}